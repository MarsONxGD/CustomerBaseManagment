# SoftwareCBM

Программа для автоматического распознавания заявок клиентов по электронной почте, их классификации и проверки наличия
артикулов в тексте для дальнейшей обработки.

- [Основной функционал](#основной-функционал)
- [Настройка](#настройка)
    - [Почтовый клиент](#1-почтовый-клиент)
    - [Классификатор писем](#2-классификатор-писем)
    - [Проверка артикулов](#3-проверка-артикулов)
- [Запуск системы](#запуск-системы)
    - [Основной скрипт](#основной-скрипт)
    - [Логирование](#логирование)
- [Структура проета](#структура-проекта)
- [Пример работы](#пример-работы)

## Основной функционал

- **Сбор писем**: Подключение к почтовому ящику по IMAP и сбор непрочитанных писем
- **Классификация писем**: Автоматическое определение, является ли письмо заявкой от клиента
- **Проверка артикулов**: Поиск и валидация артикулов в тексте писем
- **Логирование**: Подробное ведение логов работы системы

## Настройка

### 1. Почтовый клиент

Для настройки почты создайте файл `<ProgramPath>/config/email_config.py` со следующим содержимым:

```python
# <ProgramPath>/config/email_config.py
def credentials():
    config = {
        'email': 'example@email.com',
        'password': '0123456789abcdefghij',
        'imap_server': 'imap.email.com',
        'imap_port': 993
    }
    return config
```

#### Описание параметров

- `email` - адрес электронной почты
- `password` - пароль от почтового ящика или специальный пароль приложения
- `imap_server` - адрес IMAP сервера для получения почты
- `imap_port` - порт IMAP сервера (обычно 993 для SSL)

***P.S.** Замените значения параметров на актуальные для вашего почтового сервиса.*

### 2. Классификатор писем

#### Обучение модели

Для обучения классификатора нужно создать 2 датасета:

- `<ProgramPath>/datasets/data.csv` - для обучения модели
- `<ProgramPath>/datasets/test_data.csv` - для вычисления метрик

Файлы создаются данным скриптом, или любым другим по этому шаблону:

```python
# <ProjectPath>/datasets/create_data.py
import pandas as pd

data = [
    {"text": "Заявка #1", "label": 1},
    # ...
    {"text": "Заявка #N", "label": 1},
    {"text": "Не заявка #1", "label": 0},
    # ...
    {"text": "Не заявка #N", "label": 0}
]

df = pd.DataFrame(data)
df.to_csv("data.csv", index=False, encoding="utf-8-sig")

print("Файл data.csv успешно создан!")
print(f"Всего примеров: {len(df)}")
print(f"Заявок (1): {len(df[df['label'] == 1])}")
print(f"Не заявок (0): {len(df[df['label'] == 0])}")
```

#### Обучение и оценка модели

- Файл `<ProgramPath>/src/email_classifier/train.py` отвечает за обучение модели
- Файл `<ProgramPath>/src/email_classifier/metrics.py` отвечает за расчет метрик

### 3. Проверка артикулов

#### Настройка справочника артикулов

Для задания артикулов создайте файл `<ProgramPath>/config/articles.json` со следующим содержимым:

```json
[
  "AAA-001",
  "AAA-002",
  "ZZZ-998",
  "ZZZ-999"
]
```

#### Описание параметров

- `AAA-001` - Пример артикула, замените на свои значения

#### Формат артикулов

Система поддерживает артикулы в произвольных форматах

## Запуск системы

### Основной скрипт

Запустите основной файл для начала обработки писем - `<ProgramPath>/src/customer_base_management.py`

Он представляет из себя CLI с набором команд

- **receive-mail** - Получить новые письма
- **receive-mail-force** - Принудительно получить все письма
- **show-results** - Показать найденные заявки
- **show-articles** - Показать загруженные артикулы
- **cleanup-logs** - Очистить логи
- **cleanup-temp** - Очистить данные
- **cleanup-all** - Очистить всё
- **status** - Показать статус системы
- **help** - Показать эту справку
- **exit** - Выход

### Логирование

Система ведет подробные логи в файле `<ProgramPath>/log/softwarecbm.log`, включая:

- Процесс подключения к почтовому серверу
- Статистику по обработанным письмам
- Результаты классификации
- Найденные артикулы
- Ошибки и предупреждения

## Структура проекта

```
<ProgramPath>/
├── config/
│   ├── email_config.py               # Настройки почты
│   └── articles.json                 # Справочник артикулов
├── datasets/
│   ├── data.csv                      # Тренировочные данные
│   └── test_data.csv                 # Тестовые данные
├── log/
│   └── softwarecbm.log               # Файл логов
├── models/
│   ├── email_classifier.pth          # Обученная модель
│   └── vocabulary.json               # Словарь для модели
├── src/
│   ├── email_classifier/
│   │   ├── metrics.py                # Расчет метрик
│   │   ├── model.py                  # Ядро НС
│   │   ├── predict.py                # Классификатор
│   │   └── train.py                  # Обучение модели
│   ├── article_matcher.py            # Проверка артикулов
│   ├── attachment_processor.py       # Обработка вложений
│   ├── customer_base_management.py   # Основной скрипт (CLI)
│   └── email_handler.py              # Логика программы
├── temp/
│   ├── email/                        # Письма
│   │   └── attachments/              # Вложения писем
│   └── results/                      # Обработанные заявки
└── README.md
```

## Пример работы

При получении нового письма система:

1. Извлекает текст письма
2. Классифицирует его как заявку/не заявку
3. Проверяет наличие артикулов из справочника
4. Формирует отчет с результатами обработки
